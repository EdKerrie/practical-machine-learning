{
    "contents" : "---\ntitle: \"Practical Machine Learning - Course Project\"\nauthor: \"Jesse van den Berg\"\ndate: \"`r Sys.Date()`\"\noutput: html_document\n---\n\n## Source\nSix young health participants were asked to perform one set of 10 repetitions of the Unilateral Dumbbell Biceps Curl in five different fashions: exactly according to the specification (Class A), throwing the elbows to the front (Class B), lifting the dumbbell only halfway (Class C), lowering the dumbbell only halfway (Class D) and throwing the hips to the front (Class E).\n\n## Set libraries and work directory\nHere the neccesary packages are initialized. The workdirectory is also set properly.\n```{r, cache=TRUE, message=FALSE}\n# Intialize libraries\nlibrary(caret)\nlibrary(dplyr)\nlibrary(RCurl)\nlibrary(randomForest)\nlibrary(e1071)\n\n# Set working directory\nsetwd(\"C:/Users/Jesse/Documents/Coursera/Practical_Machine_Learning\")\n\n# Enable parallel backend\nlibrary(doParallel)\ncl <- makeCluster(detectCores())\nregisterDoParallel(cl)\n```\n\n## Download files\nDownload the .csv files from the website and use the dplyr package to read them into a data frame.\n```{r, cache=TRUE, message=FALSE}\n# Define URL's\ntrainingURL <- \"https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv\"\ntestingURL <- \"https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv\"\n\n# Load the files into dplyr data frames\ntraining <- tbl_df(read.csv(trainingURL, header=T, na.strings=c(\"NA\",\"\")))\ntesting <- tbl_df(read.csv(testingURL, header=T, na.strings=c(\"NA\",\"\")))\n```\n\n## Exploratory data analysis\nIn this chapter we will remove the first columns, that exist of timestamps, usernames or indices. Further, we remove the variables that exist mostly of NA's. They might be usefull for the model, but at first it is more convenient to run the model without them and see how accurate the model is. Lastly, we create a train and test set, in order to be able to test the model without overfitting to much. \n```{r, cache=TRUE, message=FALSE}\n# Remove index, timestamp and user variables\ntraining <- training[,7:160]\ntesting <- testing[,7:160]\n\n# Remove variables with mostly NA's\nmostlyData <- apply(!is.na(training),2,sum) > 19621\ntraining <- training[,mostlyData]\ntesting <- testing[,mostlyData]\n\n# Create a training and testing dataset\ninTrain <- createDataPartition(y=training$classe, p=0.7, list=FALSE)\ntraining2 <- training[inTrain,]\ntesting2 <- training[-inTrain,]\n```\n\n## Build the predictor model and set cross validation\nFirst, we will run a normal tree algorithm.\n```{r, cache=TRUE, message=FALSE}\n# Run a normal tree \ntreeModel <- train(classe ~ ., method=\"rpart\", data=training2)\n```\nWe can see that the accuracy of this model is not very good. Therefore, we will run a random forest model. This model can take long to load but is often very accurate. We use the caret package to run the randomforest algorithm, because we can include a preprocessing step for cross-validation. We set the mtry variable to 2, because we did a run with more tries, which didnt change the accuracy a bit. However, the algorithm runs much quicker with mtry = 2.\n```{r, cache=TRUE, message=FALSE}\n# Create preprocessing step for cross validation\npreProc <- trainControl(method=\"cv\",number=5, allowParallel=TRUE)\n\n# Create the model by using the train function of the caret package\nrfModel <- train(classe ~ ., method=\"rf\", tuneGrid=data.frame(mtry=2), trControl=preProc, prox=TRUE, data=training2)\nrfModel\n```\nThe random forest model has an accuracy on the training2-set of `r rfModel$results$Accuracy`.\n\n## Prediction\nThe accuracy on the training2-set is very high. To determine how accurate it is, we should use the model to predict the testing2 set and see how accurate it is. This is done by performing a prediction and making a confusion matrix.\n\n```{r}\n# Perform prediction\npredictRF <- predict(rfModel, testing2)\n\n# Get confusionmatrix\nconfMatrix <- confusionMatrix(predictRF, testing2$classe)\nconfMatrix\n```\nWe can see that the model is even more accurate to predict the testing2 set, `r confMatrix$overall[1]`. This is good enough, so this will be the final model that we use for predicting the other sets.\n\n## Expected out of sample error\nThe expected out of sample error is 1 - the accuracy, so this depends on the model. Ideally this should be as low as possible. With the current random forest model, the out of sample error is very low: `r 1 - confMatrix$overall[1]`.\n\n## Predict the 20 cases for the prediction assignment submission\nSince we have a model that predict for `r rfModel$results$Accuracy`, it is expected that the model will predict all the 20 test cases correctly. If this is not the case then we are very unlucky. Below, is the code that we used to make all the files, separately per case.\n```{r, cache=TRUE, message=FALSE}\n# Predict the answers\nanswers <- predict(rfModel, testing)\n\n# Load the function\npml_write_files = function(x){\n  n = length(x)\n  for(i in 1:n){\n    filename = paste0(\"problem_id_\",i,\".txt\")\n    write.table(x[i],file=filename,quote=FALSE,row.names=FALSE,col.names=FALSE)\n  }\n}\n\n# Run the function to make the files\nsetwd(\"C:/Users/Jesse/Documents/Coursera/Practical_Machine_Learning/Answers\")\npml_write_files(answers)\n```\n\n### Datasource\nUgulino, W.; Cardador, D.; Vega, K.; Velloso, E.; Milidiu, R.; Fuks, H. Wearable Computing: Accelerometers' Data Classification of Body Postures and Movements. Proceedings of 21st Brazilian Symposium on Artificial Intelligence. Advances in Artificial Intelligence - SBIA 2012. In: Lecture Notes in Computer Science. , pp. 52-61. Curitiba, PR: Springer Berlin / Heidelberg, 2012. ISBN 978-3-642-34458-9. DOI: 10.1007/978-3-642-34459-6_6.",
    "created" : 1450885295682.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "992133927",
    "id" : "1CDB6C9D",
    "lastKnownWriteTime" : 1450887895,
    "path" : "~/Coursera/Practical_Machine_Learning/Course_Project.Rmd",
    "project_path" : "Course_Project.Rmd",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_markdown"
}